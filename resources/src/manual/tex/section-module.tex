\section{ماژول \ماژول‌پلین{}}
\label{بخش:ماژول}

این بخش به توضیحات مربوط به طراحی و ساختار
ماژول \ماژول{} اختصاص داده شده است. هرچند اطلاع
از این موارد در به کاربردن و توسعهٔ ماژول توسط
خواننده مفید است، اما برای استفاده از آن نیازی به
دانستن این جزئیات نیست. لذا در صورتی که قصد
خواننده صرفاً فراگیری نحوهٔ کاربرد ماژول می‌باشد
توصیه می‌شود به بخش~\رجوع{بخش:کاربرد} مراجعه شود.

\subsection{طرح انتزاعی}
در طراحی ماژول سعی شده با تعریف ساختاری
انتزاعی\پانویس{Abstract} که در
فرآیندهای پرداخت الکترونیکی متداول است
بستری قابل توسعه فراهم شود تا علاوه بر سرویس واسط
زرین‌پال، توسعه‌دهندگان بتوانند آن را برای 
استفاده از دیگر سرویس‌های مشابه نیز توسعه دهند.
لذا نیاز است تعریف مجردی از اجزای دخیل در
فرآیند پرداخت الکترونیکی در اختیار داشته باشیم.
در نسخهٔ فعلی ماژول، اجزای انتزاعی زیر برای فرآیند 
پرداخت الکترونیکی در نظر گرفته شدند:
\begin{itemize}
	\فقره \متن‌ایتالیک{پرداخت}؛ \پرداخت{}
	\فقره \متن‌ایتالیک{جلسهٔ پرداخت}؛ \جلسهٔ‌پرداخت{}
	\فقره \متن‌ایتالیک{مدیر پرداخت}؛ \مدیرپرداخت{}
\end{itemize}


\subsubsection{پرداخت؛ \پرداخت‌پلین{}}
\متن‌ایتالیک{پرداخت} حاوی مشخصات و نیز
\متن‌ایتالیک{وضعیت لحظه‌ای} یک پرداخت
است که می‌تواند در هر مرحله‌ای باشد.
به عبارت دقیق‌تر، پرداخت، زمینهٔ\پانویس{Context}
مورد نیاز برای انجام یک عملیات پرداخت
را مدل می‌کند. با پایان یافتن فرآیند پرداخت،
این جزء همچنان موجودیت خود را می‌تواند حفظ کند. 

\subsubsection{جلسهٔ پرداخت؛ \جلسهٔ‌پرداخت‌پلین{}}
\متن‌ایتالیک{جلسهٔ پرداخت} وظیفهٔ مدیریت
\متن‌ایتالیک{یک} فرآیند پرداخت الکترونیکی را
\متن‌ایتالیک{از ابتدا تا انتها} بعهده دارد.
نتیجهٔ نهایی یک جلسهٔ پرداخت می‌تواند
\متن‌ایتالیک{موفق} یا \متن‌ایتالیک{ناموفق} باشد. 
پس از پایان یک فرآیند پرداخت، دورهٔ حیات
جلسهٔ پرداخت مربوط به آن نیز به پایان می‌رسد.
به بیان ساده‌تر، هر جلسهٔ پرداخت تنها تا زمانی
که فرآیند پرداخت به پایان نرسیده موجودیت دارد.

عملیات اصلی در یک جلسهٔ پرداخت عبارتند از:
\متن‌ایتالیک{ثبت}\پانویس{Registration} و
\متن‌ایتالیک{تأیید}\پانویس{Verification} پرداخت.
طی عملیات ثبت که پیش از شروع فرآیند پرداخت
اتفاق می‌افتد، مشخصات پرداخت از جمله مبلغ،
شرح، نام پرداخت‌کننده و غیره در سامانهٔ واسط
ثبت شده و شناسه‌های مورد نیاز برای ارجاع
کاربر انسانی به درگاه واسط دریافت می‌شوند\پانوشت{شرح 
این مرحله در زیربخش \رجوع{زیربخش:ثبت پرداخت} آورده شده است.}.

پس از انجام پرداخت توسط کاربر و
بازگشت به سامانهٔ گیرنده، زمان انجام
عملیات تأیید فرا می‌رسد. طی این مرحله، سامانهٔ
گیرنده اطلاع خود را از اتمام فرآیند پرداخت
به سامانهٔ واسط اعلام کرده و از او درخواست می‌کند
که در صورت موفقیت‌آمیز بودن پرداخت، نسبت به
تأیید نهایی تراکنش و انتقال قطعی وجه از حساب
کاربر انسانی اقدام کند\پانوشت{شرح این مرحله
در زیربخش \رجوع{زیربخش:تکمیل پرداخت} آورده شده است.}.

با توجه به نکات بالا، متدهای زیر برای جلسهٔ پرداخت
در نظر گرفته شده‌اند:
\begin{itemize}
	\فقره \code{register(.)} برای عملیات ثبت.
	\فقره \code{gateway(.)} برای دریافت نشانی
	درگاه جهت انتقال کاربر انسانی.
	\فقره \code{verify(.)} برای عملیات تأیید.
\end{itemize}

\subsubsection{مدیر پرداخت؛ \مدیرپرداخت‌پلین{}}
همانطور که از نام آن مشخص است،
\متن‌ایتالیک{مدیر پرداخت} وظیفهٔ مدیریت کلی
پرداخت‌ها را بعهده دارد. به عبارت دیگر، تمامی
فرآیندها/جلسات پرداختی که قرار است در سامانهٔ
مشتری اتفاق بیفتد توسط این مفهوم مدیریت می‌شود.

مدیر پرداخت نقطهٔ شروع در پیگیری یا آغاز فرآیند
پرداخت الکترونیکی است. عملیات اصلی تعریف شده برای
مدیر پرداخت عبارتند از: \متن‌ایتالیک{ایجاد} و
\متن‌ایتالیک{بازیابی} جلسهٔ پرداخت. در زمان شروع
فرآیند پرداخت الکترونیکی برای یک کاربر انسانی،
اولین مرحله ایجاد و تخصیص یک جلسهٔ پرداخت به
این فرآیند است. این موارد وظیفهٔ عملیات ایجاد
جلسهٔ پرداخت است.

بازگشت بعدی کاربر انسانی به سامانهٔ گیرنده
پس از انجام موفق یا ناموفق پرداخت الکترونیکی
اتفاق می‌افتد. اولین گام در این مرحله بازیابی
جلسهٔ پرداختی است که پیش‌تر به فرآیند پرداخت
همان کاربر اختصاص داده شده بوده است. عملیات
بازیابی جلسهٔ پرداخت مسئول انجام این بازیابی
است.

از آنچه در بالا گفته شد می‌توان مدیر پرداخت را در
واقع \متن‌ایتالیک{مدیر جلسات پرداخت} در نظر گرفت.
 با توجه به وظایف مدیر پرداخت، متدهای زیر برای
 آن در نظر گرفته شده‌اند:
 
 \begin{itemize}
 	\فقره \code{create(.)} برای ایجاد جلسهٔ پرداخت.
 	\فقره \code{get(.)} برای بازیابی جلسهٔ پرداخت متناظر با درخواست دریافت شده.
 \end{itemize}
 
 
 